<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sky Ascender</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            touch-action: none; 
            overflow: hidden; 
            background-color: #111827; 
            margin: 0;
            font-family: 'Courier New', Courier, monospace;
        }
        /* Disable blue highlight on tap */
        * { -webkit-tap-highlight-color: transparent; user-select: none; -webkit-user-select: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Configuration ---
        const GRAVITY = 0.4;
        const JUMP_FORCE = -9.5; 
        const MOVEMENT_SPEED = 6;
        const PLAYER_SIZE = 30;
        const PLATFORM_WIDTH = 60;
        const PLATFORM_HEIGHT = 15;
        const SCREEN_WIDTH = Math.min(window.innerWidth, 500);

        // --- Graphics ---
        const HeroIcon = () => (
            <svg viewBox="0 0 100 100" className="w-full h-full filter drop-shadow-lg">
                <circle cx="50" cy="50" r="45" fill="#3b82f6" stroke="#1d4ed8" strokeWidth="5" />
                <circle cx="35" cy="35" r="12" fill="white" />
                <circle cx="35" cy="35" r="5" fill="black" />
                <circle cx="65" cy="35" r="12" fill="white" />
                <circle cx="65" cy="35" r="5" fill="black" />
                <path d="M 35 70 Q 50 80 65 70" stroke="white" strokeWidth="3" fill="none" />
            </svg>
        );

        const PlatformIcon = () => (
            <div className="w-full h-full bg-gradient-to-b from-green-400 to-green-600 rounded-md border-t-4 border-green-300 shadow-lg"></div>
        );

        const SpeakerIcon = ({ muted }) => (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-8 h-8 text-white drop-shadow-md">
                {muted ? (
                    <g><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" /><line x1="23" y1="9" x2="17" y2="15" /><line x1="17" y1="9" x2="23" y2="15" /></g>
                ) : (
                    <g><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" /><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07" /></g>
                )}
            </svg>
        );

        const App = () => {
            const [gameState, setGameState] = useState('START');
            const [score, setScore] = useState(0);
            const [highScore, setHighScore] = useState(0);
            const [isMuted, setIsMuted] = useState(false);
            const [, setTick] = useState(0); // Force render

            // Refs
            const player = useRef({ x: SCREEN_WIDTH / 2, y: 0, vx: 0, vy: 0 });
            const platforms = useRef([]);
            const camera = useRef({ y: 0 });
            const inputs = useRef({ left: false, right: false });
            const reqRef = useRef(); 
            
            // Audio Context Ref
            const audioCtxRef = useRef(null);

            // Initialize Audio Engine
            const initAudio = () => {
                if (!audioCtxRef.current) {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    if (AudioContext) {
                        audioCtxRef.current = new AudioContext();
                    }
                }
                // Mobile browsers require resuming context on user gesture
                if (audioCtxRef.current && audioCtxRef.current.state === 'suspended') {
                    audioCtxRef.current.resume();
                }
            };

            // Play Synthesized Jump Sound
            const playJumpSound = () => {
                if (isMuted || !audioCtxRef.current) return;

                const ctx = audioCtxRef.current;
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();

                osc.connect(gain);
                gain.connect(ctx.destination);

                // Sound properties (Rising pitch for jump)
                osc.type = 'square';
                osc.frequency.setValueAtTime(150, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(600, ctx.currentTime + 0.1);

                // Volume envelope (Fade out)
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);

                osc.start();
                osc.stop(ctx.currentTime + 0.1);
            };

            const toggleMute = () => {
                setIsMuted(!isMuted);
            };

            // Start Game
            const initGame = () => {
                initAudio(); // Unlock audio on Start button tap

                // Reset Game State
                const startY = window.innerHeight - 100;
                player.current = { x: SCREEN_WIDTH / 2 - PLAYER_SIZE/2, y: startY - 100, vx: 0, vy: JUMP_FORCE };
                camera.current.y = 0;
                setScore(0);

                let newPlatforms = [];
                for (let i = 0; i < 15; i++) {
                    newPlatforms.push({
                        id: i,
                        x: Math.random() * (SCREEN_WIDTH - PLATFORM_WIDTH),
                        y: startY - (i * 100)
                    });
                }
                newPlatforms[0].x = SCREEN_WIDTH / 2 - PLATFORM_WIDTH/2;
                newPlatforms[0].y = startY;
                
                platforms.current = newPlatforms;
                setGameState('PLAYING');
            };

            // Game Loop
            const update = () => {
                if (gameState !== 'PLAYING') return;

                const p = player.current;
                p.vy += GRAVITY;
                p.y += p.vy;

                if (inputs.current.left) p.x -= MOVEMENT_SPEED;
                if (inputs.current.right) p.x += MOVEMENT_SPEED;

                // Wrap
                if (p.x < -PLAYER_SIZE/2) p.x = SCREEN_WIDTH - PLAYER_SIZE/2;
                if (p.x > SCREEN_WIDTH - PLAYER_SIZE/2) p.x = -PLAYER_SIZE/2;

                // Camera
                const targetY = p.y - (window.innerHeight * 0.6); 
                if (targetY < camera.current.y) {
                    camera.current.y = targetY;
                    const newScore = Math.floor(-camera.current.y / 10);
                    if(newScore > score) setScore(newScore);
                }

                // Collision
                if (p.vy > 0) {
                    platforms.current.forEach(plat => {
                        if (
                            p.x + PLAYER_SIZE * 0.8 > plat.x && 
                            p.x + PLAYER_SIZE * 0.2 < plat.x + PLATFORM_WIDTH &&
                            p.y + PLAYER_SIZE >= plat.y &&
                            p.y + PLAYER_SIZE <= plat.y + 15
                        ) {
                            p.vy = JUMP_FORCE;
                            playJumpSound(); // Play sound effect
                        }
                    });
                }

                // Platforms
                platforms.current = platforms.current.filter(plat => plat.y < camera.current.y + window.innerHeight + 100);
                const highestPlat = platforms.current[platforms.current.length - 1];
                if (highestPlat && highestPlat.y > camera.current.y - 100) {
                    platforms.current.push({
                        id: Math.random(),
                        x: Math.random() * (SCREEN_WIDTH - PLATFORM_WIDTH),
                        y: highestPlat.y - (90 + Math.random() * 40)
                    });
                }

                // Game Over
                if (p.y > camera.current.y + window.innerHeight) {
                    setHighScore(s => Math.max(s, Math.floor(-camera.current.y / 10)));
                    setGameState('GAME_OVER');
                }

                setTick(t => t + 1);
                reqRef.current = requestAnimationFrame(update);
            };

            useEffect(() => {
                if (gameState === 'PLAYING') {
                    reqRef.current = requestAnimationFrame(update);
                }
                return () => cancelAnimationFrame(reqRef.current);
            }, [gameState]);

            // Controls
            const handleTouch = (e) => {
                e.preventDefault();
                const touchX = e.touches[0].clientX;
                const middle = window.innerWidth / 2;
                if (touchX < middle) { inputs.current.left = true; inputs.current.right = false; }
                else { inputs.current.left = false; inputs.current.right = true; }
            };
            const handleTouchEnd = () => { inputs.current.left = false; inputs.current.right = false; };
            
            useEffect(() => {
                const down = (e) => { if(e.key === 'ArrowLeft') inputs.current.left = true; if(e.key === 'ArrowRight') inputs.current.right = true; };
                const up = (e) => { if(e.key === 'ArrowLeft') inputs.current.left = false; if(e.key === 'ArrowRight') inputs.current.right = false; };
                window.addEventListener('keydown', down);
                window.addEventListener('keyup', up);
                return () => { window.removeEventListener('keydown', down); window.removeEventListener('keyup', up); }
            }, []);

            return (
                <div className="w-full h-screen flex justify-center bg-gray-900">
                    <div 
                        className="relative overflow-hidden bg-sky-900 shadow-2xl"
                        style={{ width: SCREEN_WIDTH, height: '100%' }}
                        onTouchStart={handleTouch}
                        onTouchEnd={handleTouchEnd}
                        onTouchMove={handleTouch}
                    >
                        {/* Stars */}
                        <div className="absolute inset-0 opacity-40" 
                            style={{
                                background: 'radial-gradient(white 1px, transparent 1px)',
                                backgroundSize: '30px 30px',
                                transform: `translateY(${camera.current.y * 0.5}px)` 
                            }} 
                        />

                        {platforms.current.map(plat => (
                            <div key={plat.id} style={{ position: 'absolute', left: plat.x, top: plat.y - camera.current.y, width: PLATFORM_WIDTH, height: PLATFORM_HEIGHT }}>
                                <PlatformIcon />
                            </div>
                        ))}
                        
                        <div style={{ position: 'absolute', left: player.current.x, top: player.current.y - camera.current.y, width: PLAYER_SIZE, height: PLAYER_SIZE }}>
                            <HeroIcon />
                        </div>

                        {/* Score */}
                        {gameState === 'PLAYING' && (
                            <div className="absolute top-4 left-4 bg-black/30 px-3 py-1 rounded text-white font-bold text-xl border border-white/20 backdrop-blur-sm">
                                {Math.floor(-camera.current.y / 10)}m
                            </div>
                        )}
                        
                        {/* SFX Mute Toggle */}
                        <button 
                            onClick={(e) => { e.stopPropagation(); toggleMute(); }}
                            className="absolute top-4 right-4 z-50 p-2 bg-black/40 rounded-full border border-white/20 hover:bg-black/60"
                        >
                            <SpeakerIcon muted={isMuted} />
                        </button>

                        {/* Start Screen */}
                        {gameState === 'START' && (
                            <div className="absolute inset-0 flex flex-col items-center justify-center bg-black/70 text-white z-40">
                                <h1 className="text-5xl font-bold text-yellow-400 mb-2 drop-shadow-lg">SKY HOP</h1>
                                <p className="text-gray-300 mb-8">Tap Left/Right to Jump</p>
                                <button onClick={initGame} className="px-10 py-4 bg-green-500 rounded-full text-2xl font-bold shadow-[0_4px_0_rgb(21,128,61)] active:shadow-none active:translate-y-1 transition-all">
                                    START
                                </button>
                            </div>
                        )}

                        {/* Game Over */}
                        {gameState === 'GAME_OVER' && (
                            <div className="absolute inset-0 flex flex-col items-center justify-center bg-red-900/90 text-white z-40">
                                <h2 className="text-4xl font-bold mb-2">FALLEN!</h2>
                                <div className="text-6xl font-black text-yellow-300 mb-2">{highScore}m</div>
                                <p className="text-gray-300 mb-8">Best Score</p>
                                <button onClick={initGame} className="px-10 py-4 bg-blue-500 rounded-full text-2xl font-bold shadow-[0_4px_0_rgb(29,78,216)] active:shadow-none active:translate-y-1 transition-all">
                                    TRY AGAIN
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


